{% extends "main.html" %}
{% if login() == None %}
	{% include "header.html" %}
{% else %}
	{% include "header2.html" %}
{% endif %}
{% block content %}
	<div class = "row">
	<div class = "col-md-6">
	<h2>Movie List for {{user.name}}!</h2>

	{% with messages = get_flashed_messages() %}
    {% if messages %}

        <ul>
        {% for message in messages %}
          <li><strong>{{ message }} </strong> </li>
        {% endfor %}
      </ul>
    {% endif %}
    {% endwith %}
</div>
    </div>    
	<div class="row">
	<div class="col-md-1"></div>
	<div class="col-md-10">
	<div class="table-responsive">
	<table class="table user-table">
	<thead>
	<!--<tr>
	<th>Date Watched</th>
	<th>Title</th>
	<th>Description</th>
	<th>Review</th>
	<th>Rating</th>
	</tr>-->
	</thead>
	<tbody>
	{% for movie in movies %}
	<tr>
	<td id="datecell{{movie.mdbid}}" class="col-md-2"></td>
		<script type="text/javascript">
			var datewatched = "{{movie.datewatched}}";
			$('#datecell{{movie.mdbid}}').append(moment(datewatched, 'YYYY-MM-DD').format('MMMM Do, YYYY') + '<br><input value={{movie.rating}} data-size="xs" class="rating-loading">');
		</script>
	<td id="{{movie.mdbid}}"></td>
		<script type="text/javascript">
			var key = '924332c90e5f89d0bc88e02232ff0723';
			var id = {{movie.mdbid}};
			var url = 'https://api.themoviedb.org/3/movie/' + id + '?api_key=' + key;

			$.ajax({
				'url': url,
				'dataType': 'jsonp',
				'type': 'GET',
				'contentType': 'application/json',
				'async': false,
				'success': function(data, textStats, XMLHttpRequest) {
					console.log(data);
					$('#{{movie.mdbid}}').append('<img width=100 src="https://image.tmdb.org/t/p/w396/' + data.poster_path + '">');
					$('#desc{{movie.mdbid}}').append('<h4>' + data.title + '</h4>' + data.overview);
				},
				'error': function() {
					alert('There was a problem.');
				}
			});
		</script>
	<td id="desc{{movie.mdbid}}"></td>
	<td>{{movie.review}}</td>	

	{% endfor %}
	</tbody>
	</table>
	</div>
	</div>
	</div>

	<script>
	$(document).on('ready', function(){
		$('.rating-loading').rating({displayOnly: true});
	});
	</script>

{% endblock %}